services:
  mysql:
    image: mysql:8.0
    container_name: stock_mysql
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: stockdb
      MYSQL_USER: stockuser
      MYSQL_PASSWORD: stockpass
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./init:/docker-entrypoint-initdb.d:ro

  updater:
    build:
      context: ../backend/StockUpdater
    container_name: stock_updater
    depends_on:
      - mysql
    environment:
      ALPHAVANTAGE_API_KEY: ${ALPHAVANTAGE_API_KEY}
      STOCK_SYMBOLS: AAPL,MSFT,AMZN,GOOGL,TSLA
      TIMEFRAMES: D
      REQUEST_DELAY_MS: 2000
      RETRY_COUNT: 3
      MYSQL_CONNECTION_STRING: Server=mysql;Port=3306;Database=stockdb;User=stockuser;Password=stockpass;
    networks:
      - default
  
  api:
    build:
      context: ../backend/StockApi
      dockerfile: Dockerfile
    container_name: stock_api
    depends_on:
      - mysql
    environment:
      MYSQL_CONNECTION_STRING: Server=mysql;Port=3306;Database=stockdb;User=stockuser;Password=stockpass;
    ports:
      - "8080:8080"

volumes:
  mysql_data:
